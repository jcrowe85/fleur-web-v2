{{ 'analytics-dashboard.css' | asset_url | stylesheet_tag }}

<div class="analytics-dashboard-widget" data-shop="{{ shop.permanent_domain }}">
  <div class="analytics-widget-header">
    <h2 class="analytics-widget-title">Real-Time Analytics</h2>
    <div class="analytics-widget-refresh">
      <button class="analytics-refresh-btn" aria-label="Refresh analytics">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 0V4M8 12V16M12 8H16M0 8H4M13.657 2.343L11.121 4.879M4.879 11.121L2.343 13.657M13.657 13.657L11.121 11.121M4.879 4.879L2.343 2.343" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div class="analytics-widget-content">
    <div class="analytics-metrics-grid">
      <div class="analytics-metric-card">
        <div class="metric-icon">üë•</div>
        <div class="metric-content">
          <div class="metric-value" data-metric="active_visitors">-</div>
          <div class="metric-label">Active Visitors</div>
        </div>
      </div>
      
      <div class="analytics-metric-card">
        <div class="metric-icon">üìä</div>
        <div class="metric-content">
          <div class="metric-value" data-metric="bounce_rate">-</div>
          <div class="metric-label">Bounce Rate</div>
        </div>
      </div>
      
      <div class="analytics-metric-card">
        <div class="metric-icon">‚è±Ô∏è</div>
        <div class="metric-content">
          <div class="metric-value" data-metric="avg_session_time">-</div>
          <div class="metric-label">Avg Session Time</div>
        </div>
      </div>
      
      <div class="analytics-metric-card">
        <div class="metric-icon">üìÑ</div>
        <div class="metric-content">
          <div class="metric-value" data-metric="pages_per_session">-</div>
          <div class="metric-label">Pages/Session</div>
        </div>
      </div>
    </div>
    
    <div class="analytics-visitors-list">
      <h3 class="visitors-list-title">Active Visitors</h3>
      <div class="visitors-list-content" data-visitors-list>
        <div class="analytics-loading">Loading visitors...</div>
      </div>
    </div>
    
    <div class="analytics-top-pages">
      <h3 class="top-pages-title">Top Pages</h3>
      <div class="top-pages-content" data-top-pages>
        <div class="analytics-loading">Loading pages...</div>
      </div>
    </div>
  </div>
</div>

<script src="{{ 'analytics-dashboard.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Analytics Dashboard Widget",
  "settings": [
    {
      "type": "text",
      "id": "api_url",
      "label": "Analytics API URL",
      "default": "https://affiliates.tryfleur.com/api/analytics",
      "info": "Base URL for analytics API"
    },
    {
      "type": "range",
      "id": "refresh_interval",
      "label": "Refresh Interval (seconds)",
      "min": 5,
      "max": 60,
      "step": 5,
      "default": 10,
      "info": "How often to refresh analytics data"
    }
  ]
}
{% endschema %}
